<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>US Employment Map</title>
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster/dist/MarkerCluster.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster/dist/MarkerCluster.Default.css" />
    <style>
        #map {
            height: 600px;
            width: 100%;
        }
        #map-container {
            padding: 10px;
            position: relative;
        }
        #info-panel {
            position: absolute;
            top: 10px;
            right: 10px;
            background-color: white;
            padding: 10px;
            border-radius: 8px;
            box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.5);
            width: 300px;
            max-height: 400px;
            overflow-y: auto;
        }
        .legend {
            padding: 6px 8px;
            font: 14px Arial, Helvetica, sans-serif;
            background: white;
            background: rgba(255, 255, 255, 0.8);
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.2);
            border-radius: 5px;
        }
        .legend i {
            width: 18px;
            height: 18px;
            float: left;
            margin-right: 8px;
            opacity: 0.7;
        }
        .legend div {
            display: inline-block;
        }
    </style>
</head>
<body>
    <div id="map-container">
        <div id="map"></div>
        <div id="info-panel">
            <h3>State Information</h3>
            <p>Select a marker to see details.</p>
        </div>
    </div>

    <div style="margin: 10px;">
        <label for="filter-criteria">Filter By:</label>
        <select id="filter-criteria">
            <option value="total_unemployed">Total Unemployed</option>
        </select>

        <label for="range-slider">Range:</label>
        <input type="range" id="range-slider" min="0" max="100" value="50">
        <span id="range-value">50</span>%
    </div>

    <!-- Leaflet JavaScript -->
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <script src="https://unpkg.com/leaflet.markercluster/dist/leaflet.markercluster.js"></script>
    <script src="https://unpkg.com/leaflet.heat/dist/leaflet-heat.js"></script>
    
    <script>
        // Data for all 50 states, Washington D.C., and Puerto Rico
        const employmentData = [
            {state: "Alabama", total_employment: 2200000, total_unemployed: 100000, latitude: 32.806671, longitude: -86.791130},
            {state: "Alaska", total_employment: 400000, total_unemployed: 23000, latitude: 61.370716, longitude: -152.404419},
            {state: "Arizona", total_employment: 3200000, total_unemployed: 130000, latitude: 33.729759, longitude: -111.431221},
            {state: "Arkansas", total_employment: 1300000, total_unemployed: 60000, latitude: 34.969704, longitude: -92.373123},
            {state: "California", total_employment: 19000000, total_unemployed: 500000, latitude: 36.7783, longitude: -119.4179},
            {state: "Colorado", total_employment: 3200000, total_unemployed: 80000, latitude: 39.5501, longitude: -105.7821},
            {state: "Connecticut", total_employment: 1800000, total_unemployed: 85000, latitude: 41.6032, longitude: -73.0877},
            {state: "Delaware", total_employment: 500000, total_unemployed: 20000, latitude: 38.9108, longitude: -75.5277},
            {state: "Florida", total_employment: 9500000, total_unemployed: 400000, latitude: 27.9944, longitude: -81.7603},
            {state: "Georgia", total_employment: 5000000, total_unemployed: 220000, latitude: 32.1656, longitude: -82.9001},
            {state: "Hawaii", total_employment: 700000, total_unemployed: 25000, latitude: 19.8968, longitude: -155.5828},
            {state: "Idaho", total_employment: 900000, total_unemployed: 27000, latitude: 44.0682, longitude: -114.7420},
            {state: "Illinois", total_employment: 6000000, total_unemployed: 300000, latitude: 40.6331, longitude: -89.3985},
            {state: "Indiana", total_employment: 3200000, total_unemployed: 130000, latitude: 40.2672, longitude: -86.1349},
            {state: "Iowa", total_employment: 1600000, total_unemployed: 45000, latitude: 41.8780, longitude: -93.0977},
            {state: "Kansas", total_employment: 1400000, total_unemployed: 55000, latitude: 39.0119, longitude: -98.4842},
            {state: "Kentucky", total_employment: 2100000, total_unemployed: 110000, latitude: 37.8393, longitude: -84.2700},
            {state: "Louisiana", total_employment: 2000000, total_unemployed: 115000, latitude: 30.9843, longitude: -91.9623},
            {state: "Maine", total_employment: 700000, total_unemployed: 22000, latitude: 45.2538, longitude: -69.4455},
            {state: "Maryland", total_employment: 3000000, total_unemployed: 110000, latitude: 39.0458, longitude: -76.6413},
            {state: "Massachusetts", total_employment: 3800000, total_unemployed: 160000, latitude: 42.4072, longitude: -71.3824},
            {state: "Michigan", total_employment: 4700000, total_unemployed: 220000, latitude: 44.3148, longitude: -85.6024},
            {state: "Minnesota", total_employment: 3000000, total_unemployed: 87000, latitude: 46.7296, longitude: -94.6859},
            {state: "Mississippi", total_employment: 1200000, total_unemployed: 73000, latitude: 32.3547, longitude: -89.3985},
            {state: "Missouri", total_employment: 3000000, total_unemployed: 130000, latitude: 37.9643, longitude: -91.8318},
            {state: "Montana", total_employment: 700000, total_unemployed: 22000, latitude: 46.8797, longitude: -110.3626},
            {state: "Nebraska", total_employment: 1000000, total_unemployed: 27000, latitude: 41.4925, longitude: -99.9018},
            {state: "Nevada", total_employment: 1500000, total_unemployed: 54000, latitude: 38.8026, longitude: -116.4194},
            {state: "New Hampshire", total_employment: 700000, total_unemployed: 21000, latitude: 43.1939, longitude: -71.5724},
            {state: "New Jersey", total_employment: 4500000, total_unemployed: 190000, latitude: 40.0583, longitude: -74.4057},
            {state: "New Mexico", total_employment: 1000000, total_unemployed: 58000, latitude: 34.5199, longitude: -105.8701},
            {state: "New York", total_employment: 9000000, total_unemployed: 450000, latitude: 40.7128, longitude: -74.0060},
            {state: "North Carolina", total_employment: 5000000, total_unemployed: 200000, latitude: 35.7596, longitude: -79.0193},
            {state: "North Dakota", total_employment: 400000, total_unemployed: 12000, latitude: 47.5515, longitude: -101.0020},
            {state: "Ohio", total_employment: 5800000, total_unemployed: 250000, latitude: 40.4173, longitude: -82.9071},
            {state: "Oklahoma", total_employment: 1800000, total_unemployed: 80000, latitude: 35.4676, longitude: -97.5164},
            {state: "Oregon", total_employment: 2100000, total_unemployed: 85000, latitude: 43.8041, longitude: -120.5542},
            {state: "Pennsylvania", total_employment: 6000000, total_unemployed: 280000, latitude: 41.2033, longitude: -77.1945},
            {state: "Rhode Island", total_employment: 500000, total_unemployed: 24000, latitude: 41.5801, longitude: -71.4774},
            {state: "South Carolina", total_employment: 2400000, total_unemployed: 94000, latitude: 33.8361, longitude: -81.1637},
            {state: "South Dakota", total_employment: 500000, total_unemployed: 15000, latitude: 43.9695, longitude: -99.9018},
            {state: "Tennessee", total_employment: 3500000, total_unemployed: 130000, latitude: 35.5175, longitude: -86.5804},
            {state: "Texas", total_employment: 14000000, total_unemployed: 600000, latitude: 31.9686, longitude: -99.9018},
            {state: "Utah", total_employment: 1500000, total_unemployed: 36000, latitude: 39.320980, longitude: -111.093731},
            {state: "Vermont", total_employment: 350000, total_unemployed: 10000, latitude: 44.5588, longitude: -72.5778},
            {state: "Virginia", total_employment: 4500000, total_unemployed: 160000, latitude: 37.4316, longitude: -78.6569},
            {state: "Washington", total_employment: 4000000, total_unemployed: 170000, latitude: 47.7511, longitude: -120.7401},
            {state: "West Virginia", total_employment: 800000, total_unemployed: 51000, latitude: 38.5976, longitude: -80.4549},
            {state: "Wisconsin", total_employment: 3100000, total_unemployed: 99000, latitude: 43.7844, longitude: -88.7879},
            {state: "Wyoming", total_employment: 400000, total_unemployed: 13000, latitude: 43.075968, longitude: -107.290284},
            {state: "District of Columbia", total_employment: 700000, total_unemployed: 35000, latitude: 38.9072, longitude: -77.0369},
            {state: "Puerto Rico", total_employment: 1200000, total_unemployed: 92000, latitude: 18.2208, longitude: -66.5901}
        ];

        function createMap(data) {
            // Initialize the map and set its view to the USA
            let myMap = L.map("map").setView([37.0902, -95.7129], 4); // Centering on the USA with zoom level 4

            // Define tile layers
            let street = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
            }).addTo(myMap); // Adding street layer by default

            let topo = L.tileLayer('https://{s}.tile.opentopomap.org/{z}/{x}/{y}.png', {
                attribution: 'Map data: &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, <a href="http://viewfinderpanoramas.org">SRTM</a> | Map style: &copy; <a href="https://opentopomap.org">OpenTopoMap</a> (<a href="https://creativecommons.org/licenses/by-sa/3.0/">CC-BY-SA</a>)'
            });

            // Create marker clusters and heat array
            let markers = L.markerClusterGroup();
            let heatArray = [];

            // Loop through data to create markers and populate the heatmap
            data.forEach(row => {
                let latitude = parseFloat(row.latitude);
                let longitude = parseFloat(row.longitude);

                if (latitude && longitude) {
                    let point = [latitude, longitude];

                    // Create marker and bind popup
                    let marker = L.marker(point);
                    let popup = `
                        <h1>${row.state}</h1>
                        <hr><h3>Total Employment: ${row.total_employment}</h3>
                        <hr><h3>Total Unemployed: ${row.total_unemployed}</h3>`;
                    marker.bindPopup(popup);
                    markers.addLayer(marker);

                    // Show information in the info panel on marker click
                    marker.on('click', function() {
                        document.getElementById('info-panel').innerHTML = popup;
                    });

                    // Add point to heat array
                    heatArray.push(point);
                }
            });

            // Create heat layer and add to map
            let heatLayer = L.heatLayer(heatArray, {
                radius: 25,
                blur: 20
            });

            // Define base layers and overlay layers
            let baseLayers = {
                "Street Map": street,
                "Topographic Map": topo
            };

            let overlayLayers = {
                "Markers": markers,
                "Heatmap": heatLayer
            };

            // Add marker cluster and heat layer to map
            myMap.addLayer(markers);
            myMap.addLayer(heatLayer);

            // Add layer control to the map
            L.control.layers(baseLayers, overlayLayers).addTo(myMap);

            // Add a legend to the map
            let legend = L.control({ position: 'bottomright' });
            legend.onAdd = function () {
                let div = L.DomUtil.create('div', 'legend');
                div.innerHTML = '<strong>Legend</strong><br>';
                div.innerHTML += '<i style="background: red"></i><div>High Unemployment</div><br>';
                div.innerHTML += '<i style="background: yellow"></i><div>Medium Unemployment</div><br>';
                div.innerHTML += '<i style="background: green"></i><div>Low Unemployment</div><br>';
                return div;
            };
            legend.addTo(myMap);
        }

        // Initialize map with embedded data
        createMap(employmentData);

        // Event listener for filter criteria
        document.getElementById("filter-criteria").addEventListener("change", function () {
            let criteria = this.value;
            let rangeValue = document.getElementById("range-slider").value;
            filterMap(criteria, rangeValue);
        });

        document.getElementById("range-slider").addEventListener("input", function () {
            let rangeValue = this.value;
            document.getElementById("range-value").textContent = rangeValue + "%";
            let criteria = document.getElementById("filter-criteria").value;
            filterMap(criteria, rangeValue);
        });

        function filterMap(criteria, rangeValue) {
            let filteredData = employmentData.filter(row => {
                return parseFloat(row[criteria]) >= rangeValue;
            });

            createMap(filteredData);
        }
    </script>
</body>
</html>